<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instala√ß√µes Residenciais</title>
    <link rel="stylesheet" href="../../Styles/principalCss/sytleDesafioTematico.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>

<body>
    <header class="header">
        <nav class="navbar">
            <a href="../Principal/Home.html">Inicio</a>
            <a href="../Principal/Cursos.html">Cursos</a>
            <a href="../Principal/Sobre.html">Sobre</a>
        </nav>
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="logo-img">
                <img class="logo" src="../../Img/Logotipo-TCC__1_-removebg-preview.png" alt="Logo">
            </div>

            <nav class="menu">
                <button onclick="window.location.href='../Principal/Perfil.html'">
                    <span>
                        <img class="perfil" src="../../Img/tl.webp" alt="perfil">
                        <span>Perfil</span>
                    </span>
                </button>

                <button onclick="window.location.href='../Principal/Praticar.html'">
                    <span>
                        <img class="praticar" src="../../Img/tl (1).webp" alt="praticar">
                        <span>Praticar</span>
                    </span>
                </button>

                <button onclick="window.location.href='../Principal/Ranking-campus.html'">
                    <span>
                        <img class="ranking" src="../../Img/thumbnail_large.png" alt="">
                        <span>Ranking</span>
                    </span>
                </button>

                <button onclick="window.location.href='../Principal/Mais.html'">
                    <span>
                        <img class="mais" src="../../Img/tl (3).webp" alt="Mais">
                        <span>Mais</span>
                    </span>
                </button>
            </nav>
        </aside>
    </div>

    <main class="main-tematico">
        <h1>üè† Instala√ß√µes Residenciais</h1>
        <p class="descricao">Desafio pr√°tico sobre dimensionamento e execu√ß√£o de instala√ß√µes el√©tricas residenciais!</p>

        <div id="conteudo-instalacoes" class="quiz-card">
            <h2 id="pergunta">Carregando pergunta...</h2>
            <ul class="alternativas">
                <li><button onclick="responder(0)">Op√ß√£o 1</button></li>
                <li><button onclick="responder(1)">Op√ß√£o 2</button></li>
                <li><button onclick="responder(2)">Op√ß√£o 3</button></li>
                <li><button onclick="responder(3)">Op√ß√£o 4</button></li>
            </ul>
            <p class="aviso">‚ö†Ô∏è Voc√™ tem apenas uma chance! Escolha com cuidado.</p>
        </div>

        <button class="voltar" onclick="window.location.href='Tematicos-Eletro.html'">‚Üê Voltar</button>
    </main>

    <script src="../../Scripts/migration.js"></script>
    <script src="../../Scripts/utils.js"></script>
    <script src="../../Scripts/auth.js"></script>
    <script src="../../Scripts/progress.js"></script>
    <script src="../../Scripts/desafios.js"></script>
    <script src="../../Scripts/mobile-block.js"></script>

    <script>
        const perguntas = [
            {
                pergunta: "Qual a tens√£o padr√£o em instala√ß√µes residenciais no Brasil?",
                alternativas: ["110V ou 220V", "Apenas 110V", "Apenas 220V", "380V"],
                correta: 0,
                xp: 50
            },
            {
                pergunta: "Qual a bitola m√≠nima de condutor para circuitos de tomadas em resid√™ncias?",
                alternativas: ["1,5 mm¬≤", "2,5 mm¬≤", "4 mm¬≤", "6 mm¬≤"],
                correta: 1,
                xp: 50
            },
            {
                pergunta: "O que √© um circuito de distribui√ß√£o terminal?",
                alternativas: [
                    "Circuito do poste at√© o medidor",
                    "Circuito do quadro at√© os pontos de utiliza√ß√£o",
                    "Circuito principal da rua",
                    "Circuito de emerg√™ncia"
                ],
                correta: 1,
                xp: 50
            },
            {
                pergunta: "Qual dispositivo protege contra sobrecarga e curto-circuito?",
                alternativas: [
                    "Interruptor simples",
                    "Tomada",
                    "Disjuntor termomagn√©tico",
                    "Fus√≠vel apenas"
                ],
                correta: 2,
                xp: 50
            },
            {
                pergunta: "De acordo com a NBR-5410, qual a altura padr√£o para instala√ß√£o de interruptores?",
                alternativas: [
                    "1,0m do piso",
                    "1,2m do piso",
                    "1,5m do piso",
                    "2,0m do piso"
                ],
                correta: 1,
                xp: 50
            }
        ];

        let perguntaAtual = 0;
        let acertos = 0;
        let tentou = false;

        function carregarPergunta() {
            if (perguntaAtual >= perguntas.length) {
                finalizarDesafio();
                return;
            }

            const p = perguntas[perguntaAtual];
            document.getElementById('pergunta').textContent = p.pergunta;
            
            const botoes = document.querySelectorAll('.alternativas button');
            botoes.forEach((btn, index) => {
                btn.textContent = p.alternativas[index];
                btn.disabled = false;
                btn.style.background = '#1e88e5';
            });

            tentou = false;
        }

        function responder(opcao) {
            if (tentou) return;
            tentou = true;

            const p = perguntas[perguntaAtual];
            const botoes = document.querySelectorAll('.alternativas button');

            botoes.forEach(btn => btn.disabled = true);

            if (opcao === p.correta) {
                botoes[opcao].style.background = '#4caf50';
                acertos++;
                adicionarXP(p.xp);
                
                setTimeout(() => {
                    perguntaAtual++;
                    carregarPergunta();
                }, 1500);
            } else {
                botoes[opcao].style.background = '#e53935';
                botoes[p.correta].style.background = '#4caf50';
                
                setTimeout(() => {
                    alert('‚ùå Resposta incorreta! Tente novamente mais tarde.');
                    window.location.href = 'Tematicos-Eletro.html';
                }, 2000);
            }
        }

        function finalizarDesafio() {
            const usuario = obterUsuarioLogado();
            if (usuario && !usuario.desafios.tematicos['instalacoes-residenciais']) {
                usuario.desafios.tematicos['instalacoes-residenciais'] = true;
                atualizarUsuarioLogado(usuario);
            }

            document.querySelector('.quiz-card').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #4caf50; font-size: 2rem;">üéâ Parab√©ns!</h2>
                    <p style="font-size: 1.3rem; margin: 20px 0;">
                        Voc√™ completou o desafio de Instala√ß√µes Residenciais!
                    </p>
                    <p style="font-size: 1.1rem; color: #1e88e5;">
                        ‚úÖ ${acertos}/${perguntas.length} quest√µes corretas<br>
                        üí∞ +${acertos * 50} XP ganhos!
                    </p>
                    <button onclick="window.location.href='Tematicos-Eletro.html'" style="
                        margin-top: 20px;
                        padding: 15px 30px;
                        background: #1e88e5;
                        border: none;
                        border-radius: 8px;
                        color: white;
                        font-size: 1.1rem;
                        cursor: pointer;
                    ">Voltar aos Desafios</button>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const usuario = obterUsuarioLogado();
            if (!usuario) {
                window.location.href = '../../pages/Login/index.html';
                return;
            }

            if (usuario.curso !== "Eletrot√©cnica") {
                alert("‚ö†Ô∏è Este desafio √© exclusivo para alunos de Eletrot√©cnica!");
                window.location.href = '../Principal/Praticar.html';
                return;
            }

            if (usuario.desafios.tematicos && usuario.desafios.tematicos['instalacoes-residenciais']) {
                document.querySelector('.quiz-card').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #4caf50;">
                        <h2>‚úÖ Desafio J√° Conclu√≠do!</h2>
                        <p style="font-size: 1.2rem; margin-top: 20px;">
                            Voc√™ j√° completou este desafio!
                        </p>
                        <button onclick="window.location.href='Tematicos-Eletro.html'" style="
                            margin-top: 20px;
                            padding: 15px 30px;
                            background: #1e88e5;
                            border: none;
                            border-radius: 8px;
                            color: white;
                            font-size: 1.1rem;
                            cursor: pointer;
                        ">Voltar</button>
                    </div>
                `;
            } else {
                carregarPergunta();
            }
        });
    </script>
</body>
</html>